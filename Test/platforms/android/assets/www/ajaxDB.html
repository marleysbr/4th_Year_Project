<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="format-detection" content="telephone=no" />
		<!-- WARNING from Cordova: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
		<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
		<title></title>
	</head>

	<body> 
		<input type="button" class="buttonClass" onclick='window.location="index.html"' value="Return">
		<div class="segment">
			<h2>Serving Data from External Server</h2>
			<form action="" method="GET" id="formPowerType">
				<br><input type="button" id="button" class="buttonClass" value="GO" onSubmit="return showUser()">
			</form>
			<br>
			<div id="txtHint">(Data will be displayed here)</div>
		</div>

		<script>
			// --------------------------- CORS begin
			// Create the XHR object.
			function createCORSRequest(method, url) {
				var xhr = new XMLHttpRequest();
				if ("withCredentials" in xhr) {
					// XHR for Chrome/Firefox/Opera/Safari.
					xhr.open(method, url, true);
					console.log('withCredentials');
				} 
				else if (typeof XDomainRequest != "undefined") {
					// XDomainRequest for IE.
					xhr = new XDomainRequest();
					xhr.open(method, url);
				} 
				else {
					// CORS not supported.
					xhr = null;
				}
				return xhr;
			}

			function makeCORSRequest() {
				var xhr = createCORSRequest('GET', url);
				if (!xhr) {
					alert('CORS not supported');
					return;
				}
				xhr.onLoad = function() {
					console.log("onloadn");
				}
				xhr.onError = function() {
					alert('Error accessing database.');
				};
				xhr.send();
			}
			// --------------------------- CORS end

			function showUser() {
								
				document.getElementById("txtHint").innerHTML = "Getting data ..."; 
				
				xmlhttp.onReadyStateChange=function() {
					if (xmlhttp.readyState==4 && xmlhttp.status==200) {
						var txt = xmlhttp.responseText;
						document.getElementById("txtHint").innerHTML = xmlhttp.responseText;
					}
				}
				// Need full URL to page, since this HTML page is not on a server
				xmlhttp.open("GET","http://marlan4thyearproject.comli.com/getChurches.php",truexmlhttp.send());
				xmlhttp.send();
			}

			// Start the CORS on startup
			var url = "http://marlan4thyearproject.comli.com/";
			var method = "GET";
			createCORSRequest(method, url);
		</script>
	</body>
</html>